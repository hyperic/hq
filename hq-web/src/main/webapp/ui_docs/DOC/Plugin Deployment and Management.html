<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 5.0 : Plugin Deployment and Management</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 5.0.html" title="vFabric Hyperic 5.0 Documentation Home">vFabric Hyperic 5.0 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-5.0.html">Hyperic 5.0 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 5.0 : Plugin Deployment and Management
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jul 10, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <style type='text/css'>/*<![CDATA[*/
div.rbtoc1341941934125 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1341941934125 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1341941934125 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1341941934125'>
<ul>
    <li><a href='#PluginDeploymentandManagement-KeyHypericPluginManagementFeatures'>Key Hyperic Plugin Management Features</a></li>
    <li><a href='#PluginDeploymentandManagement-VersionRequirementsforPluginSynchronization'>Version Requirements for Plugin Synchronization</a></li>
    <li><a href='#PluginDeploymentandManagement-PluginAdministrationTasks'>Plugin Administration Tasks</a></li>
    <li><a href='#PluginDeploymentandManagement-ResourcePluginDeploymentDirectories'>Resource Plugin Deployment Directories</a></li>
    <li><a href='#PluginDeploymentandManagement-AboutPluginManager'>About Plugin Manager</a></li>
    <li><a href='#PluginDeploymentandManagement-AboutCustomPluginDeploymentwithPluginManager'>About Custom Plugin Deployment with Plugin Manager</a></li>
    <li><a href='#PluginDeploymentandManagement-AboutPluginRemovalwithPluginManager'>About Plugin Removal with Plugin Manager</a></li>
    <li><a href='#PluginDeploymentandManagement-AboutPluginSyncatStartup'>About Plugin Sync at Startup</a></li>
<ul>
    <li><a href='#PluginDeploymentandManagement-AboutPluginSyncatAgentStartup'>About Plugin Sync at Agent Startup</a></li>
    <li><a href='#PluginDeploymentandManagement-AboutPluginSyncatServerStartup'>About Plugin Sync at Server Startup</a></li>
</ul>
    <li><a href='#PluginDeploymentandManagement-DisableServerAgentPluginSynchronization'>Disable Server-Agent Plugin Synchronization</a></li>
</ul></div>


<h1><a name="PluginDeploymentandManagement-KeyHypericPluginManagementFeatures"></a>Key Hyperic Plugin Management Features</h1>

<p>Hyperic product plugin management and deployment features ensure that all Hyperic Agents reporting the Hyperic Server run exactly the same product plugins as those deployed to the server. The key features are:</p>

<ul>
	<li>Plugin management interface &#8212; <b>Plugin Manager</b> is a user interface for deployment-wide management of product plugins. You use the <b>Plugin Manager</b> to deploy and manage plugins on the Hyperic Server and Hyperic Agents that report to the server. For more information, see <a href="#PluginDeploymentandManagement-AboutPluginManager">About Plugin Manager</a> below.</li>
</ul>


<ul>
	<li>Server-Agent Plugin Synchronization (SAPS) &#8212; A Hyperic Agent and the Hyperic Server it reports to cooperate to ensure that the agent is running exactly the same set of plugins as the server. For more information, see <a href="#PluginDeploymentandManagement-AboutPluginSyncatStartup">About Plugin Sync at Startup</a> below. SAPS is enabled by default, and can be disabled using the <tt>server.pluginsync.enabled</tt> property in the server's <tt>ServerHome\conf\server.conf</tt> file.</li>
</ul>


<h1><a name="PluginDeploymentandManagement-VersionRequirementsforPluginSynchronization"></a>Version Requirements for Plugin Synchronization</h1>

<p>The SAPS process will <em>not</em> synchronize plugins on agents of an earlier version than the Hyperic Server. The Hyperic Server can only synchronize plugins on agents running the same or later version. The <b>Plugin Manager</b> user interface indicates how many of the agents reporting to the server are in sync.  If there are agents that are out-of-date, you can see which agents need upgrading. For more information, see <a href="ui-Administration.Plugin.Manager.html" title="ui-Administration.Plugin.Manager">ui&#45;Administration.Plugin.Manager</a>.</p>

<h1><a name="PluginDeploymentandManagement-PluginAdministrationTasks"></a>Plugin Administration Tasks </h1>

<p>If you run Hyperic with SAPS enabled, you can use <b>Plugin Manager</b> to administer plugins on up-to-date agents throughout your Hyperic deployment. The primary tasks you perform are:</p>

<ul>
	<li>Deploy and update custom plugins &#8212; If you develop your own plugin, or customize a built-in plugin, use <b>Plugin Manager</b> to upload and deploy the new or modified plugin to the Hyperic Server and to all up-to-date agents in your deployment. Plugins you deploy with <b>Plugin Manager</b> are deployed to a directory external to the Hyperic Server's installation directory, so that they are not overwritten by a server upgrade. For more information, see <a href="#PluginDeploymentandManagement-ResourcePluginDeploymentDirectories">Resource Plugin Deployment Directories</a> below.</li>
</ul>


<ul>
	<li>Remove plugins &#8212; For optimal Hyperic scalability, it is good practice reduce agent footprint by running only the plugins you use, and to remove a plugin if you have no resources of the types the plugin manages. You can remove one or more plugins from all up-to-date agents in your deployment with a single <b>Plugin Manager</b> command.  (Prior to version 4.6, Hyperic releases did not provide a friendly mechanism for plugin removal; the suggested alternative was to configure each agent to include or exclude selected plugins, using the <tt>plugins.exclude</tt> or <tt>plugins.exclude</tt> agent properties. This method is still supported.)</li>
</ul>


<div class='panelMacro'><table class='warningMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Manual plugin deployment not supported</b><br />Prior to Hyperic 4.6, product plugins were manually deployed to agents and the Hyperic Server, separately, with no mechanism to determine or enforce consistency between the server and agents. In Hyperic 4.6 and later, manual plugin deployment is not supported &#8212; use <b>Plugin Manager</b> for all product plugin administration tasks.</td></tr></table></div>


<h1><a name="PluginDeploymentandManagement-ResourcePluginDeploymentDirectories"></a>Resource Plugin Deployment Directories</h1>

<p>There are two product plugin deployment directories on the Hyperic Server:</p>

<ul>
	<li><tt>ServerHome/hq-engine/hq-server/webapps/ROOT/WEB_INF/hq-plugins/</tt> &#8212; This is the deployment directory for the standard plugins packaged with Hyperic Server.</li>
</ul>


<ul>
	<li><tt>user.dir/hq-plugins</tt> &#8212; When you deploy a custom plugin, or a customized version of a built-in plugin, <b>Plugin Manager</b> deploys it to the <tt>hq-plugins</tt> subdirectory of the current working directory of the Hyperic Server process. Custom plugins are deployed to a separate plugin directory, external to the server installation, so that they will not be overwritten when you upgrade the Hyperic Server. You can configure the server to store custom plugins in a different directory with the <tt>server.plugin.custom.dir</tt> property. For more information, see <tt><a href="server.plugin.custom.dir.html" title="server.plugin.custom.dir">server.plugin.custom.dir</a></tt>.</li>
</ul>


<p>On the Hyperic Agent <em>all</em> product plugins reside in the same directory &#8212; <tt>AgentHome/bundles/agent-x.y.z/pdk/plugins/</tt> &#8212; which is where built-in plugins are installed, and where <b>Plugin Manager</b> deploys custom plugins, including customized versions of built-in plugins.</p>

<h1><a name="PluginDeploymentandManagement-AboutPluginManager"></a>About Plugin Manager</h1>

<p><b>Plugin Manager</b>, available on the <b>HQ Server Settings</b> section of the <b>Administration</b> tab, is a user interface for deployment-wide management of product plugins. You can use the <b>Plugin Manager</b> to administer plugins on the Hyperic Server and on all up-to-date Hyperic Agents that report to the server.   </p>

<p><b>Plugin Manager</b> displays all plugins deployed to the Hyperic Server, and the status of each plugin on agents reporting to the server.  </p>

<p>You can use <b>Plugin Manager</b> to upload new plugins, update existing plugins, and remove plugins. The changes you make are replicated on all up-to-date agents that report to the server. Note that plugins you upload must comply with plugin naming conventions, and may not be larger than 5 MB.</p>

<p>When you remove one or more plugins using <b>Plugin Manager</b>, all resources in inventory of types managed by the plugin are removed from inventory.</p>

<p>For information about using the <b>Plugin Manager</b>, see <a href="ui-Administration.Plugin.Manager.html" title="ui-Administration.Plugin.Manager">Manage Plugins with the Plugin Manager</a>.</p>


<h1><a name="PluginDeploymentandManagement-AboutCustomPluginDeploymentwithPluginManager"></a>About Custom Plugin Deployment with Plugin Manager</h1>

<p>When you upload a new or updated plugin with the <b>Plugin Manager</b>:</p>

<ol>
	<li>The plugin is copied to the Hyperic Server's <tt>user.dir/hq-plugins</tt> directory.</li>
	<li>If a product plugin of the same name exists in the server's <tt>hq-plugins</tt> directory (likely to be the case if you are deploying a customized version of a built-in plugin), the version in <tt>user.dir/hq-plugins</tt> henceforth is loaded, rather than the version in the server's <tt>hq-plugins</tt> directory (<tt>ServerHome/hq-engine/hq-server/webapps/ROOT/WEB_INF/hq-plugins/</tt>).</li>
	<li>The Hyperic Server updates and restarts each up-to-date agent. Note that agent update and agent restart are asynchronous &#8212; the server processes two queues: one of agents that still need the update pushed, and one of those that have the update and need to be restarted.
	<ul>
		<li>The server pushes the new or changed plugins to all up-to-date agents, up to four at a time. A built-in throttle mechanism limits the number of agent update threads.</li>
		<li>The server issues a restart command to each updated agent, up to 20 in parallel. A built-in throttle mechanism limits the number of agent restart threads.</li>
	</ul>
	</li>
</ol>


<h1><a name="PluginDeploymentandManagement-AboutPluginRemovalwithPluginManager"></a>About Plugin Removal with Plugin Manager</h1>

<p>You can use the <b>Plugin Manager</b> to remove  one or more plugins from the Hyperic Server and all up-to-date agents that report to the server. </p>

<p>When you remove a plugin:</p>

<ol>
	<li>The plugin is removed from its deployment directory on the Hyperic Server.</li>
	<li>The plugin is removed from its deployment directory on each up-to-date Hyperic Agent reporting to the server, and each agent is restarted.</li>
	<li>All resources in inventory managed by the removed plugin are removed from Hyperic's resource inventory.</li>
</ol>


<h1><a name="PluginDeploymentandManagement-AboutPluginSyncatStartup"></a>About Plugin Sync at Startup</h1>
<p>Server-side and agent-side plugins can become out-of-sync if you manually add or remove plugins and do not apply updates consistently to the server and to every agent.</p>

<p>To detect plugin mismatches caused by inconsistent manual deployment, the Hyperic Server checks for out-of-sync plugins every time it starts up, and every time an agent connects to it upon agent start or restart. (The Hyperic Server does the post-startup checks five minutes after startup, so that any agents that were restarted while the server was down to sync their plugin inventory.)  In the case of a mismatch between server-side and agent-side plugins, the Hyperic Server updates the agent.</p>

<p>The synchronization behavior described in the sections below apply only to up-to-date agents, as noted in <a href="#PluginDeploymentandManagement-VersionRequirementsforPluginSynchronization">Version Requirements for Plugin Synchronization</a>.<br/>
<a name="PluginDeploymentandManagement-AgentStartupSync"></a></p>

<h2><a name="PluginDeploymentandManagement-AboutPluginSyncatAgentStartup"></a>About Plugin Sync at Agent Startup</h2>

<p>When an up-to-date agent starts up and loads the plugins in its plugin directory, it sends a plugin status report to the server, including the MD5 checksum of each plugin it loaded.</p>

<p>On receipt of a plugin status report from an up-to-date agent, the Hyperic Server compares the MD5 checksum of each plugin that the agent loaded with the the MD5 checksum of the corresponding plugin (a plugin with the same name) currently deployed on the server. </p>

<p>For a mismatch: </p>
<ul>
	<li>If the agent loaded a plugin with the same name but different MD5 checksum than one that is currently deployed to the Hyperic Server, the server pushes its version to the agent.</li>
	<li>If the agent did not load a plugin that is currently deployed to the server (the agent did not load a plugin with the same name as one that the server loaded), the server pushes the plugin to the agent.</li>
	<li>If the agent loaded a plugin that is not deployed to the Hyperic Server (there is no plugin with the same name on the server), the server removes the plugin from the agent.</li>
</ul>


<p>After adding or removing agent plugins as necessary, the server restarts the agent.</p>

<p><a name="PluginDeploymentandManagement-ServerStartupSync"></a></p>
<h2><a name="PluginDeploymentandManagement-AboutPluginSyncatServerStartup"></a>About Plugin Sync at Server Startup</h2>

<p>When the Hyperic Server starts up and loads the plugins in its deployment directories, it <br/>
compares the MD5 checksum of the plugins it loaded with the MD5 checksums in the plugin status report last received from each agent. </p>

<p>For a mismatch:</p>
<ul>
	<li>If an agent's last plugin status report included a plugin with the same name but different MD5 checksum than one that is currently deployed to the Hyperic Server, the server pushes its version to the agent.</li>
	<li>If an agent's last plugin status report does not include a plugin that is currently deployed to the server (the agent did not load a plugin with the same name as one that the server loaded), the server pushes the plugin to the agent.</li>
	<li>If an agent's last plugin status report included a plugin that is not deployed to the Hyperic Server (there is no plugin with the same name on the server), the server removes the plugin from the agent.</li>
</ul>


<p>After updating the agent plugins appropriately, the server restarts the agent.</p>

<h1><a name="PluginDeploymentandManagement-DisableServerAgentPluginSynchronization"></a>Disable Server-Agent Plugin Synchronization</h1>

<p>SAPS is enabled by default. To disable SAPS, add the following line to <tt>ServerHome/conf/hq-server.conf</tt>:</p>

<p><tt>server.pluginsync.enabled=false</tt></p>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jul 10, 2012 14:23</font></td>
		    </tr>
	    </table>
    </body>
</html>
